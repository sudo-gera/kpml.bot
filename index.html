<!--252a0a3c21444f43545950452068746d6c205055424c494320222d2f2f5733432f2f445444205848544d4c20312e30205472616e736974696f6e616c2f2f454e222022687474703a2f2f7777772e77332e6f72672f54522f7868746d6c312f4454442f7868746d6c312d7472616e736974696f6e616c2e647464223e0a3c68746d6c20786d6c6e733d22687474703a2f2f7777772e77332e6f72672f313939392f7868746d6c223e0a3c686561643e0a3c6d65746120687474702d65717569763d22436f6e74656e742d547970652220636f6e74656e743d22746578742f68746d6c3b20636861727365743d5554462d3822202f3e0a3c7469746c653ed180d0b5d0b4d0b0d0bad182d0bed18020d0b8d0b7d0bcd0b5d0bdd0b5d0bdd0b8d0b920d0b220d180d0b0d181d0bfd0b8d181d0b0d0bdd0b8d0b83c2f7469746c653e0a3c7374796c653e0a626f6479207b0a20206865696768743a20313030253b0a7d0a0a0a7465787461726561207b0a202077696474683a20393576773b0a20206865696768743a20373776683b0a7d0a0a627574746f6e207b0a20666f6e742d66616d696c793a636f75726965723b0a7d0a0a236d656e757b0a20706f736974696f6e3a206162736f6c7574653b0a20746f703a2033253b0a206865696768743a203130253b0a7d0a0a23686561647b0a20706f736974696f6e3a206162736f6c7574653b0a20746f703a20303b0a206865696768743a2033253b0a7d0a0a236d61696e7b0a20706f736974696f6e3a206162736f6c7574653b0a20626f74746f6d3a20303b0a206865696768743a203830253b0a7d0a0a3c2f7374796c653e0a3c2f686561643e0a3c626f64793e0a3c6469762069643d2268656164223e3c2f6469763e0a3c6469762069643d226d656e75223e3c2f6469763e0a3c6469762069643d226d61696e223e3c2f6469763e0a3c7363726970743e0a66756e6374696f6e20646f776e6c6f61642866696c656e616d652c207465787429207b0a202076617220656c656d656e74203d20646f63756d656e742e637265617465456c656d656e7428276127293b0a2020656c656d656e742e736574417474726962757465282768726566272c2027646174613a746578742f706c61696e3b636861727365743d7574662d382c27202b20656e636f6465555249436f6d706f6e656e74287465787429293b0a2020656c656d656e742e7365744174747269627574652827646f776e6c6f6164272c2066696c656e616d65293b0a0a2020656c656d656e742e7374796c652e646973706c6179203d20276e6f6e65273b0a2020646f63756d656e742e626f64792e617070656e644368696c6428656c656d656e74293b0a0a2020656c656d656e742e636c69636b28293b0a0a2020646f63756d656e742e626f64792e72656d6f76654368696c6428656c656d656e74293b0a7d0a2a250a6465662073686f7728712c77293a0a20646f63756d656e742e676574456c656d656e74427949642871292e696e6e657248544d4c3d770a73686f7728276d61696e272c273c666f726d206e616d653d226d61696e666f726d223e3c7465787461726561206e616d653d226d61696e7465787422203e3c2f74657874617265613e3c2f666f726d3e27290a73686f77282768656164272c2727270a3c627574746f6e206f6e636c69636b3d22736176652829223e736176653c2f627574746f6e3e0a3c627574746f6e206f6e636c69636b3d226f70656e5f732829223e6f70656e3c2f627574746f6e3e0a272727290a64656620646566636828712c77293a0a20696620713d3d756e646566696e65643a0a202072657475726e20770a2072657475726e20710a783d300a793d300a637572736f7273746172743d300a637572736f72656e643d300a656469745f613d5b302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c302c305d0a656469745f763d27270a646566206564697428293a0a20636865636b28290a206c3d27d090d091d092270a207465643d273c7461626c653e3c74723e270a2063633d300a20666f7220653c333a0a2020666f7220313d773c31323a0a2020206f3d27270a2020206f2b3d537472696e672877290a2020206f2b3d6c5b655d0a2020207465642b3d273c74643e3c627574746f6e206f6e636c69636b3d22656469745f6328272b537472696e67286363292b27293b72657475726e2066616c7365223e270a202020656469745f615b63635d3d6f0a20202063632b3d310a2020207465642b3d6f0a2020207465642b3d273c2f627574746f6e3e3c2f74643e270a20207465642b3d273c2f74723e3c74723e270a206461793d6e6577204461746528290a20666f7220773c31313a0a20206f3d27270a20206f2b3d537472696e67286461792e676574446174652829292e706164537461727428322c273027292b272e270a20206f2b3d537472696e67286461792e6765744d6f6e746828292b31292e706164537461727428322c273027290a20207465642b3d273c74643e3c627574746f6e206f6e636c69636b3d22656469745f6328272b537472696e67286363292b2729223e270a2020656469745f615b63635d3d6f0a202063632b3d310a20207465642b3d6f0a20207465642b3d273c2f627574746f6e3e3c2f74643e270a20206461792e73657444617465286461792e6765744461746528292b31290a207465642b3d273c2f74723e3c2f7461626c653e270a2073686f7728276d656e75272c746564290a20636865636b28290a64656620656469745f632871293a0a20743d656469745f615b715d0a20733d646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e76616c75652e73706c697428275c6e27295b795d0a20733d732e73706c69742827203c3c3c20787878203e3e3e2027295b305d2e73706c697428277c27290a20666f7220773c732e6c656e6774683a0a2020735b775d3d735b775d2e7472696d28290a20696620732e696e6465784f662874293d3d2d313a0a2020732e707573682874290a20656c73653a0a2020733d732e66696c7465722866756e6374696f6e28762c692c61297b72657475726e2076213d747d290a20733d732e6a6f696e28277c27290a20732b3d27203c3c3c20787878203e3e3e20272b20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e74657874202e76616c75652e73706c697428275c6e27295b795d2e73706c69742827203c3c3c20787878203e3e3e2027295b315d0a20643d646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e76616c75652e73706c697428275c6e27290a20645b795d3d730a20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e76616c75653d642e6a6f696e28275c6e27290a20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e666f63757328290a2020646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e2073657453656c656374696f6e52616e676528637572736f7273746172742c637572736f72656e64290a20636865636b28290a2072657475726e2066616c73650a646566207361766528293a0a20636865636b28290a20646f776e6c6f616428276b706d6c2e747874272c20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e76616c7565290a646566206f70656e5f7328293a0a2073686f7728276d656e75272c2727273c666f726d206e616d653d226f70656e666f726d22206f6e6368616e67653d226f70656e5f6f28293b72657475726e2066616c7365223e3c696e70757420747970653d2266696c6522206e616d653d226f70656e74657874222f3e3c2f666f726d3e3c627574746f6e206f6e636c69636b3d226564697428293b72657475726e2066616c7365223e63616e63656c3c2f627574746f6e3e272727290a20636865636b28290a646566206f70656e5f6f28293a0a2066696c656f3d646f63756d656e742e666f726d732e6f70656e666f726d2e656c656d656e74732e6f70656e746578742e66696c65735b305d0a2069662066696c656f3a0a202066696c656f2e7465787428292e7468656e286f70656e5f74290a646566206f70656e5f742874657874293a0a20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e76616c75653d746578740a20636865636b28290a206564697428290a646566207265742871293a0a20613d646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e76616c75652e73706c697428275c6e27295b795d0a20613d612e73706c69742827203c3c3c20787878203e3e3e2027295b305d2e73706c697428277c27290a20666f7220773c612e6c656e6774683a0a2020615b775d3d615b775d2e7472696d28290a20733d612e736c69636528290a206332643d310a20666f7220773c612e6c656e6774683a0a2020696620615b775d2e696e6465784f6628272e27292b313a0a202020735b775d3d6e6577204461746528290a202020735b775d2e73657444617465285c0a20202020286e65772044617465285c0a2020202020286e657720446174652829292e67657446756c6c5965617228292c5c0a20202020204e756d62657228615b775d2e73706c697428272e27295b305d2c3130292d312c5c0a20202020204e756d62657228615b775d2e73706c697428272e27295b305d2c3130295c0a2020202029292e6765744461746528292b715c0a202020290a202020735b775d3d537472696e6728735b775d2e676574446174652829292e706164537461727428322c273027295c0a2020202b272e272b537472696e6728735b775d2e6765744d6f6e746828292b31292e706164537461727428322c273027290a2020656c73653a0a202020735b775d3d735b775d2e7265706c6163652827d090272c273127292e7265706c6163652827d091272c273227292e7265706c6163652827d092272c33290a202020735b775d3d4e756d62657228735b775d292b710a202020696620735b775d2531303d3d303a0a20202020735b775d2d3d370a202020696620735b775d2531303d3d343a0a20202020735b775d2b3d370a202020735b775d3d537472696e6728735b775d290a202020735b775d3d735b775d2e736c69636528302c735b775d2e6c656e6774682d31292b273dd090d091d092275b4e756d62657228735b775d5b735b775d2e6c656e6774682d315d295d0a202020696620735b775d3d3d273132d090273a0a20202020735b775d3d2735d090270a202020206332643d300a202020696620735b775d3d3d2734d092273a0a20202020735b775d3d273131d092270a202020206332643d300a202020696620735b775d3d3d27d092273a0a20202020735b775d3d273131d092270a202020206332643d300a20666f7220773c612e6c656e6774683a0a202069662063326420616e6420312b615b775d2e696e6465784f6628272e27293a0a202020706173730a2020656c73653a0a202020615b775d3d735b775d0a20613d612e6a6f696e28277c27290a20733d610a20732b3d27203c3c3c20787878203e3e3e20272b20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e74657874202e76616c75652e73706c697428275c6e27295b795d2e73706c69742827203c3c3c20787878203e3e3e2027295b315d0a20643d646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e76616c75652e73706c697428275c6e27290a20645b795d3d730a20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e76616c75653d642e6a6f696e28275c6e27290a20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e666f63757328290a20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e2073657453656c656374696f6e52616e676528637572736f7273746172742c637572736f72656e64290a20636865636b28290a646566206b65792871293a0a20696620712e6374726c4b65793a0a2020696620712e77686963683d3d37363a0a2020207265742831290a20202072657475726e2066616c73650a2020696620712e77686963683d3d38303a0a202020726574282d31290a20202072657475726e2066616c73650a6564697428290a64656620636865636b28293a0a20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e666f63757328290a20613d646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e76616c75652e73706c697428275c6e27290a20637572736f7273746172743d646566636828746869732e73656c656374696f6e53746172742c637572736f727374617274290a20637572736f72656e643d646566636828746869732e73656c656374696f6e456e642c637572736f72656e64290a20783d637572736f7273746172740a20793d300a20666f7220773c3a773c612e6c656e67746820616e6420782d615b775d2e6c656e6774682d313e3d303a0a2020792b3d310a2020782d3d615b775d2e6c656e6774682b310a20746f6461793d6e6577204461746528290a20646174653d537472696e6728746f6461792e676574446174652829292e706164537461727428322c273027290a20646174652b3d272e272b537472696e6728746f6461792e6765744d6f6e746828292b31292e706164537461727428322c273027290a20646174653d5b646174655d0a20636c61733d5b2735d090275d0a206f3d34300a20666f7220653c612e6c656e6774683a0a2020733d615b655d0a2020696620732e696e6465784f662827203c3c3c20787878203e3e3e20272920213d202d313a0a202020733d732e73706c69742827203c3c3c20787878203e3e3e2027290a2020656c696620732e696e6465784f662827203c3c3c20787878203e3e3e272920213d202d313a0a202020733d732e73706c69742827203c3c3c20787878203e3e3e27290a2020656c696620732e696e6465784f662827203c3c3c20787878203e3e272920213d202d313a0a202020733d732e73706c69742827203c3c3c20787878203e3e27290a2020656c696620732e696e6465784f662827203c3c3c20787878203e272920213d202d313a0a202020733d732e73706c69742827203c3c3c20787878203e27290a2020656c696620732e696e6465784f662827203c3c3c2078787820272920213d202d313a0a202020733d732e73706c69742827203c3c3c207878782027290a2020656c696620732e696e6465784f662827203c3c3c20787878272920213d202d313a0a202020733d732e73706c69742827203c3c3c2078787827290a2020656c696620732e696e6465784f662827203c3c3c207878272920213d202d313a0a202020733d732e73706c69742827203c3c3c20787827290a2020656c696620732e696e6465784f662827203c3c3c2078272920213d202d313a0a202020733d732e73706c69742827203c3c3c207827290a2020656c696620732e696e6465784f662827203c3c3c20272920213d202d313a0a202020733d732e73706c69742827203c3c3c2027290a2020656c696620732e696e6465784f662827203c3c3c272920213d202d313a0a202020733d732e73706c69742827203c3c3c27290a2020656c73653a0a202020733d5b27272c735d0a2020696620735b305d2e6c656e6774683a0a202020735b305d3d735b305d2e73706c697428277c27290a2020656c73653a0a202020735b305d3d5b5d0a2020666f7220773c735b305d2e6c656e6774683a0a202020735b305d5b775d3d735b305d5b775d2e7472696d28290a202063646174653d300a202063636c61733d300a2020666f7220773c735b305d2e6c656e6774683a0a202020696620735b305d5b775d2e696e6465784f6628272e27293d3d2d313a0a2020202063636c61733d310a202020656c73653a0a2020202063646174653d310a202069662063646174653a0a202020646174653d5b5d0a202069662063636c61733a0a202020636c61733d5b5d0a2020666f7220773c735b305d2e6c656e6774683a0a202020696620735b305d5b775d2e696e6465784f6628272e27293d3d2d313a0a2020202069662063636c61733a0a2020202020636c61732e7075736828735b305d5b775d290a202020656c73653a0a2020202069662063646174653a0a2020202020646174652e7075736828735b305d5b775d290a202069662063646174653d3d303a0a202020735b305d3d735b305d2e636f6e6361742864617465290a202069662063636c61733d3d303a0a202020735b305d3d735b305d2e636f6e63617428636c6173290a2020735b305d3d735b305d2e6a6f696e28277c27290a2020735b305d3d735b305d2e70616453746172742834302c272027290a20206f3d28735b305d2b27203c3c3c20787878203e3e3e2027292e6c656e6774680a2020733d732e6a6f696e2827203c3c3c20787878203e3e3e2027290a2020615b655d3d730a20613d612e6a6f696e28275c6e27290a20646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e76616c75653d610a20696620783c6f3a0a2020646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e666f63757328290a2020646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e2073657453656c656374696f6e52616e676528637572736f7273746172742b6f2d782c637572736f72656e642b6f2d78290a736574496e74657276616c28636865636b2c353030290a646f63756d656e742e6f6e6b6579646f776e3d6b65790a646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e6f6e6b6579646f776e3d636865636b0a646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e6f6e6b657975703d636865636b0a646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e6f6e6b657970726573733d636865636b0a646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e6f6e6d6f757365646f776e3d636865636b0a646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e6f6e6d6f75736575703d636865636b0a646f63756d656e742e666f726d732e6d61696e666f726d2e656c656d656e74732e6d61696e746578742e6f6e6d6f75736570726573733d636865636b0a252a0a3c2f7363726970743e0a3c2f626f64793e0a3c2f68746d6c3e0a2a250a-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>редактор изменений в расписании</title>
<style>
body {
  height: 100%;
}


textarea {
  width: 95vw;
  height: 77vh;
}

button {
 font-family:courier;
}

#menu{
 position: absolute;
 top: 3%;
 height: 10%;
}

#head{
 position: absolute;
 top: 0;
 height: 3%;
}

#main{
 position: absolute;
 bottom: 0;
 height: 80%;
}

</style>
</head>
<body>
<div id="head"></div>
<div id="menu"></div>
<div id="main"></div>
<script>
function download(filename, text) {
  var element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  element.setAttribute('download', filename);

  element.style.display = 'none';
  document.body.appendChild(element);

  element.click();

  document.body.removeChild(element);
}

 function show (  q ,  w ){
 document . getElementById ( q ) . innerHTML = w;}
show ( 'main' , '<form name="mainform"><textarea name="maintext" ></textarea></form>' );
show ( 'head' , "\n<button onclick=\"save()\">save</button>\n<button onclick=\"open_s()\">open</button>\n" );
 function defch (  q ,  w ){
 if(q == undefined ){
  return w;}
 return q;}
x = 0;
y = 0;
cursorstart = 0;
cursorend = 0;
edit_a = [ 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ];
edit_v = '';
 function edit (){
 check ( );
 l = 'АБВ';
 ted = '<table><tr>';
 cc = 0;
 for(e =0;e < 3;e ++){
  for( w =1 ; w < 12; w ++){
   o = '';
   o += String ( w );
   o += l [ e ];
   ted += '<td><button onclick="edit_c(' + String ( cc ) + ');return false">';
   edit_a [ cc ] = o;
   cc += 1;
   ted += o;
   ted += '</button></td>';}
  ted += '</tr><tr>';}
 day = new Date ( );
 for(w =0;w < 11;w ++){
  o = '';
  o += String ( day . getDate ( ) ) . padStart ( 2 , '0' ) + '.';
  o += String ( day . getMonth ( ) + 1 ) . padStart ( 2 , '0' );
  ted += '<td><button onclick="edit_c(' + String ( cc ) + ')">';
  edit_a [ cc ] = o;
  cc += 1;
  ted += o;
  ted += '</button></td>';
  day . setDate ( day . getDate ( ) + 1 );}
 ted += '</tr></table>';
 show ( 'menu' , ted );
 check ( );}
 function edit_c (  q ){
 t = edit_a [ q ];
 s = document . forms . mainform . elements . maintext . value . split ( '\n' ) [ y ];
 s = s . split ( ' <<< xxx >>> ' ) [ 0 ] . split ( '|' );
 for(w =0;w < s . length;w ++){
  s [ w ] = s [ w ] . trim ( );}
 if(s . indexOf ( t ) == - 1 ){
  s . push ( t );}
 else{
  s = s . filter ( function ( v , i , a ) { return v != t } );}
 s = s . join ( '|' );
 s += ' <<< xxx >>> ' + document . forms . mainform . elements . maintext . value . split ( '\n' ) [ y ] . split ( ' <<< xxx >>> ' ) [ 1 ];
 d = document . forms . mainform . elements . maintext . value . split ( '\n' );
 d [ y ] = s;
 document . forms . mainform . elements . maintext . value = d . join ( '\n' );
 document . forms . mainform . elements . maintext . focus ( );{
  document . forms . mainform . elements . maintext . setSelectionRange ( cursorstart , cursorend );}
 check ( );
 return false;}
 function save (){
 check ( );
 download ( 'kpml.txt' , document . forms . mainform . elements . maintext . value );}
 function open_s (){
 show ( 'menu' , "<form name=\"openform\" onchange=\"open_o();return false\"><input type=\"file\" name=\"opentext\"/></form><button onclick=\"edit();return false\">cancel</button>" );
 check ( );}
 function open_o (){
 fileo = document . forms . openform . elements . opentext . files [ 0 ];
 if(fileo ){
  fileo . text ( ) . then ( open_t );}}
 function open_t (  text ){
 document . forms . mainform . elements . maintext . value = text;
 check ( );
 edit ( );}
 function ret (  q ){
 a = document . forms . mainform . elements . maintext . value . split ( '\n' ) [ y ];
 a = a . split ( ' <<< xxx >>> ' ) [ 0 ] . split ( '|' );
 for(w =0;w < a . length;w ++){
  a [ w ] = a [ w ] . trim ( );}
 s = a . slice ( );
 c2d = 1;
 for(w =0;w < a . length;w ++){
  if(a [ w ] . indexOf ( '.' ) + 1 ){
   s [ w ] = new Date ( );
   s [ w ] . setDate ( ( new Date ( ( new Date ( ) ) . getFullYear ( ) , Number ( a [ w ] . split ( '.' ) [ 0 ] , 10 ) - 1 , Number ( a [ w ] . split ( '.' ) [ 0 ] , 10 ) ) ) . getDate ( ) + q );
   s [ w ] = String ( s [ w ] . getDate ( ) ) . padStart ( 2 , '0' ) + '.' + String ( s [ w ] . getMonth ( ) + 1 ) . padStart ( 2 , '0' );}
  else{
   s [ w ] = s [ w ] . replace ( 'А' , '1' ) . replace ( 'Б' , '2' ) . replace ( 'В' , 3 );
   s [ w ] = Number ( s [ w ] ) + q;
   if(s [ w ] % 10 == 0 ){
    s [ w ] -= 7;}
   if(s [ w ] % 10 == 4 ){
    s [ w ] += 7;}
   s [ w ] = String ( s [ w ] );
   s [ w ] = s [ w ] . slice ( 0 , s [ w ] . length - 1 ) + '=АБВ' [ Number ( s [ w ] [ s [ w ] . length - 1 ] ) ];
   if(s [ w ] == '12А' ){
    s [ w ] = '5А';
    c2d = 0;}
   if(s [ w ] == '4В' ){
    s [ w ] = '11В';
    c2d = 0;}
   if(s [ w ] == 'В' ){
    s [ w ] = '11В';
    c2d = 0;}}}
 for(w =0;w < a . length;w ++){
  if(c2d && 1 + a [ w ] . indexOf ( '.' ) ){
   }
  else{
   a [ w ] = s [ w ];}}
 a = a . join ( '|' );
 s = a;
 s += ' <<< xxx >>> ' + document . forms . mainform . elements . maintext . value . split ( '\n' ) [ y ] . split ( ' <<< xxx >>> ' ) [ 1 ];
 d = document . forms . mainform . elements . maintext . value . split ( '\n' );
 d [ y ] = s;
 document . forms . mainform . elements . maintext . value = d . join ( '\n' );
 document . forms . mainform . elements . maintext . focus ( );
 document . forms . mainform . elements . maintext . setSelectionRange ( cursorstart , cursorend );
 check ( );}
 function key (  q ){
 if(q . ctrlKey ){
  if(q . which == 76 ){
   ret ( 1 );
   return false;}
  if(q . which == 80 ){
   ret ( - 1 );
   return false;}}}
edit ( );
 function check (){
 document . forms . mainform . elements . maintext . focus ( );
 a = document . forms . mainform . elements . maintext . value . split ( '\n' );
 cursorstart = defch ( this . selectionStart , cursorstart );
 cursorend = defch ( this . selectionEnd , cursorend );
 x = cursorstart;
 y = 0;
 for(w =0; w < a . length && x - a [ w ] . length - 1 >= 0;w ++){
  y += 1;
  x -= a [ w ] . length + 1;}
 today = new Date ( );
 date = String ( today . getDate ( ) ) . padStart ( 2 , '0' );
 date += '.' + String ( today . getMonth ( ) + 1 ) . padStart ( 2 , '0' );
 date = [ date ];
 clas = [ '5А' ];
 o = 40;
 for(e =0;e < a . length;e ++){
  s = a [ e ];
  if(s . indexOf ( ' <<< xxx >>> ' ) != - 1 ){
   s = s . split ( ' <<< xxx >>> ' );}
  else if(s . indexOf ( ' <<< xxx >>>' ) != - 1 ){
   s = s . split ( ' <<< xxx >>>' );}
  else if(s . indexOf ( ' <<< xxx >>' ) != - 1 ){
   s = s . split ( ' <<< xxx >>' );}
  else if(s . indexOf ( ' <<< xxx >' ) != - 1 ){
   s = s . split ( ' <<< xxx >' );}
  else if(s . indexOf ( ' <<< xxx ' ) != - 1 ){
   s = s . split ( ' <<< xxx ' );}
  else if(s . indexOf ( ' <<< xxx' ) != - 1 ){
   s = s . split ( ' <<< xxx' );}
  else if(s . indexOf ( ' <<< xx' ) != - 1 ){
   s = s . split ( ' <<< xx' );}
  else if(s . indexOf ( ' <<< x' ) != - 1 ){
   s = s . split ( ' <<< x' );}
  else if(s . indexOf ( ' <<< ' ) != - 1 ){
   s = s . split ( ' <<< ' );}
  else if(s . indexOf ( ' <<<' ) != - 1 ){
   s = s . split ( ' <<<' );}
  else{
   s = [ '' , s ];}
  if(s [ 0 ] . length ){
   s [ 0 ] = s [ 0 ] . split ( '|' );}
  else{
   s [ 0 ] = [ ];}
  for(w =0;w < s [ 0 ] . length;w ++){
   s [ 0 ] [ w ] = s [ 0 ] [ w ] . trim ( );}
  cdate = 0;
  cclas = 0;
  for(w =0;w < s [ 0 ] . length;w ++){
   if(s [ 0 ] [ w ] . indexOf ( '.' ) == - 1 ){
    cclas = 1;}
   else{
    cdate = 1;}}
  if(cdate ){
   date = [ ];}
  if(cclas ){
   clas = [ ];}
  for(w =0;w < s [ 0 ] . length;w ++){
   if(s [ 0 ] [ w ] . indexOf ( '.' ) == - 1 ){
    if(cclas ){
     clas . push ( s [ 0 ] [ w ] );}}
   else{
    if(cdate ){
     date . push ( s [ 0 ] [ w ] );}}}
  if(cdate == 0 ){
   s [ 0 ] = s [ 0 ] . concat ( date );}
  if(cclas == 0 ){
   s [ 0 ] = s [ 0 ] . concat ( clas );}
  s [ 0 ] = s [ 0 ] . join ( '|' );
  s [ 0 ] = s [ 0 ] . padStart ( 40 , ' ' );
  o = ( s [ 0 ] + ' <<< xxx >>> ' ) . length;
  s = s . join ( ' <<< xxx >>> ' );
  a [ e ] = s;}
 a = a . join ( '\n' );
 document . forms . mainform . elements . maintext . value = a;
 if(x < o ){
  document . forms . mainform . elements . maintext . focus ( );
  document . forms . mainform . elements . maintext . setSelectionRange ( cursorstart + o - x , cursorend + o - x );}}
setInterval ( check , 500 );
document . onkeydown = key;
document . forms . mainform . elements . maintext . onkeydown = check;
document . forms . mainform . elements . maintext . onkeyup = check;
document . forms . mainform . elements . maintext . onkeypress = check;
document . forms . mainform . elements . maintext . onmousedown = check;
document . forms . mainform . elements . maintext . onmouseup = check;
document . forms . mainform . elements . maintext . onmousepress = check;

</script>
</body>
</html>


